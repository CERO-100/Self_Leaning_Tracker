{# tracker/templates/registration/login.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Login | Self-Learning Tracker{% endblock %}

{% block content %}
<div class="container my-5" style="max-width: 500px;">
  <div class="text-center mb-4">
    <h2 class="fw-bold text-gray-800">Welcome Back</h2>
    <p class="text-muted">Continue your learning journey</p>
  </div>

  <div class="card shadow-lg border-0 rounded-3">
    <div class="card-body p-5">

      <!-- Google Login Button -->
      <div class="text-center mb-4">
        <a href="{% url 'socialaccount_login' 'google' %}" 
           class="btn btn-light border shadow-sm rounded-pill d-flex align-items-center justify-content-center" 
           style="gap:8px;">
          <img src="https://cdn.jsdelivr.net/npm/simple-icons@9.26.0/icons/google.svg" 
               alt="Google icon" style="width:20px;height:20px;">
          <span>Continue with Google</span>
        </a>
      </div>

      <!-- Divider -->
      <div class="text-center mb-4">
        <hr class="my-3">
        <span class="text-muted bg-white px-3">or sign in with email</span>
      </div>

      <!-- Error Messages -->
      {% if form.errors %}
        <div class="alert alert-danger">
          <h6 class="alert-heading">Login Failed</h6>
          {% for field, errors in form.errors.items %}
            {% for error in errors %}
              <small class="d-block">{{ error }}</small>
            {% endfor %}
          {% endfor %}
        </div>
      {% endif %}

      <form method="post" novalidate id="login-form">
        {% csrf_token %}

        <!-- Username Field -->
        <div class="mb-3">
          <label for="{{ form.username.id_for_label }}" class="form-label fw-semibold">
            <i class="fas fa-user me-1 text-primary"></i>Username
          </label>
          {{ form.username|add_class:"form-control" }}
        </div>

        <!-- Password Field -->
        <div class="mb-4">
          <label for="{{ form.password.id_for_label }}" class="form-label fw-semibold">
            <i class="fas fa-lock me-1 text-primary"></i>Password
          </label>
          <div class="input-group">
            <input type="password" 
                   class="form-control" 
                   id="{{ form.password.id_for_label }}" 
                   name="{{ form.password.name }}"
                   placeholder="Enter your password"
                   required>
            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
              <i class="fas fa-eye" id="toggleIcon"></i>
            </button>
          </div>
        </div>

        <!-- Remember Me & Forgot Password -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="rememberMe">
            <label class="form-check-label text-muted" for="rememberMe">
              Remember me
            </label>
          </div>
          <a href="{% url 'password_reset' %}" class="text-primary text-decoration-none">
            Forgot password?
          </a>
        </div>

        <div class="d-grid mb-3">
          <button type="submit" class="btn btn-primary btn-lg fw-semibold">
            <i class="fas fa-sign-in-alt me-2"></i>Sign In
          </button>
        </div>
      </form>

      <div class="text-center">
        <p class="mb-0 text-muted">
          Don't have an account?
          <a href="{% url 'register' %}" class="text-primary fw-semibold text-decoration-none">Create one here</a>
        </p>
      </div>
    </div>
  </div>

  <!-- Features Preview -->
  <div class="text-center mt-4">
    <small class="text-muted">
      <i class="fas fa-check-circle text-success me-1"></i>Track your learning progress
      <span class="mx-2">•</span>
      <i class="fas fa-trophy text-warning me-1"></i>Earn badges and XP
      <span class="mx-2">•</span>
      <i class="fas fa-clock text-info me-1"></i>Pomodoro timer included
    </small>
  </div>
</div>

<style>
  .form-control {border-radius:8px; border:1px solid #dee2e6; padding:12px 16px; font-size:0.95rem; transition:all 0.3s;}
  .form-control:focus {border-color:#2A9D8F; box-shadow:0 0 0 0.2rem rgba(42,157,143,.25);}
  .btn-primary {background:linear-gradient(135deg,#2A9D8F 0%,#6D6875 100%); border:none; border-radius:8px; padding:12px 24px; transition:all .3s;}
  .btn-primary:hover {transform:translateY(-1px); box-shadow:0 4px 12px rgba(42,157,143,0.3);}
  .card {border-radius:16px;}
  .alert {border-radius:8px; border:none;}
  .btn-light {transition:all .3s;}
  .btn-light:hover {transform:translateY(-1px); box-shadow:0 2px 8px rgba(0,0,0,0.1);}
  .input-group .btn-outline-secondary {border-left:none; border-radius:0 8px 8px 0;}
  .input-group .form-control {border-right:none; border-radius:8px 0 0 8px;}
  .input-group .form-control:focus {border-right:none;}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Password toggle
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('{{ form.password.id_for_label }}');
    const toggleIcon = document.getElementById('toggleIcon');
    if (togglePassword && passwordInput) {
        togglePassword.addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            toggleIcon.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
        });
    }
    // Autofocus
    const firstInput = document.getElementById('{{ form.username.id_for_label }}');
    if (firstInput) { firstInput.focus(); }
});
</script>
{% endblock %}

